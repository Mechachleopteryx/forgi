

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>RNA Secondary Structure as a Graph Using the forgi Library &#8212; forgi 2.0.0 documentation</title>
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="RNA 3D Structure Using forgi.threedee" href="threedee_tutorial.html" />
    <link rel="prev" title="Useful scripts coming with forgi" href="scripts_tutorial.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>forgi 2.0.0 documentation</span></a></h1>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="scripts_tutorial.html">Useful scripts coming with forgi</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="threedee_tutorial.html">RNA 3D Structure Using forgi.threedee</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="rna-secondary-structure-as-a-graph-using-the-forgi-library">
<span id="forgi-graph-tutorial"></span><h1>RNA Secondary Structure as a Graph Using the forgi Library<a class="headerlink" href="#rna-secondary-structure-as-a-graph-using-the-forgi-library" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>forgi is a library for manipulating RNA as a graph-like
structure. It provides classes for reading, storing, manipulating and
outputting RNA structures. It classifies and stores RNA secondary
structure in a data structure that quickly allows one to determine
which elements are connected and which nucleotides they contain.</p>
<p>The secondary structure of an RNA molecule can be divided into
five different types of ‘elements’. Each element is assigned a name that
can be used to refer to it and to determine its identity:</p>
<ul class="simple">
<li><strong>fiveprime:</strong> The unpaired nucleotides at the 5’ end of a molecule/ chain. Name always starts with ‘f’ (e.g. ‘f0’).</li>
<li><strong>threeprime</strong>: The unpaired nucleotides at the 3’ end of a molecule/ chain. Name always start with ‘t’ (e.g. ‘t0’)</li>
<li><dl class="first docutils">
<dt><strong>stem:</strong> Regions of contiguous canonical Watson-Crick base-paired nucleotides. By default, stems have at least 2 consecutive basepairs.</dt>
<dd>Always start with ‘s’ (e.g., ‘s0’, ‘s1’, ‘s2’, …)</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>interior loop:</strong> Bulged out nucleotides and interior loops. An interior loop can contain unpaired bases on either strand or on both strands, flanked by stems on either side.</dt>
<dd>Always start with ‘i’ (‘i0’, ‘i1’, ‘i2’,…)</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>multiloop segment:</strong> Single-stranded regions bewteen two stems. Always start with ‘m’. (‘m0’, ‘m1’, ‘m2’…)</dt>
<dd>In the current version of forgi, pseudo-knots and exterior loops segments between stems are treated as multiloop segments.</dd>
</dl>
</li>
<li><strong>hairpin loop:</strong> Always starts with ‘h’.</li>
</ul>
</div>
<div class="section" id="a-simple-example">
<h2>A Simple Example<a class="headerlink" href="#a-simple-example" title="Permalink to this headline">¶</a></h2>
<p>The use of forgi is perhaps best illustrated with an
example.</p>
<p>Let’s take an RNA sequence:</p>
<p><code class="docutils literal"><span class="pre">CGCUUCAUAUAAUCCUAAUGAUAUGGUUUGGGAGUUUCUACCAAGAGCCUUAAACUCUUGAUUAUGAAGUG</span></code></p>
<p>We can predict its secondary structure using one of a number of tools,
including the Vienna RNA Package’s RNAfold program:</p>
<p><a class="reference external" href="http://rna.tbi.univie.ac.at/cgi-bin/RNAWebSuite/RNAfold.cgi">http://rna.tbi.univie.ac.at/cgi-bin/RNAWebSuite/RNAfold.cgi</a></p>
<p>This will return a minimum free energy structure which can be represented using
dot-bracket notation:</p>
<p><code class="docutils literal"><span class="pre">(((((((((...((((((.........))))))........((((((.......))))))..)))))))))</span></code></p>
<p>The secondary structure can be visualized using
<a class="reference external" href="https://www.tbi.univie.ac.at/RNA/RNAplot.1.html">RNAplot</a>.
Forgi also contains wrapper code that calls the ViennaRNA library (the basis of RNAplot)
to generate the graph layout and visualizes it using matpoltlib:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">forgi.visual.mplotlib</span> <span class="k">as</span> <span class="nn">fvm</span>
<span class="kn">import</span> <span class="nn">forgi</span>
<span class="n">cg</span> <span class="o">=</span> <span class="n">forgi</span><span class="o">.</span><span class="n">load_rna</span><span class="p">(</span><span class="s2">&quot;examples/input/1y26.fx&quot;</span><span class="p">,</span> <span class="n">allow_many</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fvm</span><span class="o">.</span><span class="n">plot_rna</span><span class="p">(</span><span class="n">cg</span><span class="p">,</span> <span class="n">text_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontweight&quot;</span><span class="p">:</span><span class="s2">&quot;black&quot;</span><span class="p">},</span> <span class="n">lighten</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
             <span class="n">backbone_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;linewidth&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/1y26_ss.png" class="align-center" src="_images/1y26_ss.png" />
<p>Evident in this image are six structural elements.</p>
<blockquote>
<div><ul class="simple">
<li>3 stems</li>
<li>2 hairpin loops</li>
<li>1 multiloop (consisting of 3 multiloop segments)</li>
</ul>
</div></blockquote>
<p>Each of these elements is connected to certain other elements. For
example, the stem at the top is connected to two unpaired regions of the
multi-loop. Both of the hairpin loops are connected to one stem each. If we
abstract away the sequence information, we can imagine the structure as being
represented by a graph.</p>
<p id="forgibgformat">The forgi package can be used to do just this using the <code class="code docutils literal"><span class="pre">rnaConvert.py</span></code> script:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ python examples/rnaConvert.py examples/input/1y26_ss.dotbracket -T forgi
name untitled
length 71
define m2 34 41
define h1 48 54
define s2 42 47 55 60
define s1 13 18 28 33
define s0 1 9 63 71
define m1 10 12
define h0 19 27
define m0 61 62
connect s2 h1 m0 m2
connect s1 h0 m1 m2
connect s0 m1 m0
</pre></div>
</div>
<p>The define section contain one secondary structure element per line.
The numbers indicate the nucleotides that are
present in each element. So the stem s0 is composed of nucleotides 1 to 9 on
one strand and 63 to 71 on the other. The other elements are described in a
similar manner. The hairpin <em>h0</em> includes the nucleotides 19 to 27.
The <em>connect</em> section describes the edges in the graph.</p>
<p>In this case it is difficult to picture which section is which from the text
representation. To make it easier, we will generate a file
readable by graphviz. The <em>neato</em> program can take that as input and create a
nice visualization of the graph:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">examples</span><span class="o">/</span><span class="n">rnaConvert</span><span class="o">.</span><span class="n">py</span> <span class="n">examples</span><span class="o">/</span><span class="nb">input</span><span class="o">/</span><span class="mi">1</span><span class="n">y26_ss</span><span class="o">.</span><span class="n">dotbracket</span> <span class="o">-</span><span class="n">T</span> <span class="n">neato</span> <span class="o">|</span> <span class="n">neato</span> <span class="o">-</span><span class="n">Tpng</span> <span class="o">-</span><span class="n">o</span> <span class="mi">1</span><span class="n">y26_neato</span><span class="o">.</span><span class="n">png</span>
</pre></div>
</div>
<p>The result is the following graph representation of the structure.</p>
<a class="reference internal image-reference" href="_images/1y26_neato.png"><img alt="_images/1y26_neato.png" class="align-center" src="_images/1y26_neato.png" style="width: 200px; height: 200px;" /></a>
<p>Here square nodes represent stems and round nodes represent other elements.
The connections in this representation do not contain any nucleotides,
but simply illustrate which coarse grained elements are connected to each other.</p>
<p>The label of the nodes are the element names (as described above), so “s0” means stem number 0.
The numbers in parenthesis below the element names represent the number of nucleotides in the element.
In case of interior loops (not shown in this example), there can be two numbers, if the RNA has
unpaired nucleotides on both sides of the bulge.</p>
<p>Notice the similarity to the original base paired image? The top stem can be
identified as <em>s0</em>. The two hairpin loops are <em>h0</em> and <em>h1</em>. The regions in the
multiloop are given their own names.</p>
<p>This graph visualization is useful to get an idea of the coarse grained representation
of the RNA introduced by forgi. However, some information is lost in this picture:
This graph only shows, which stem is connected to which bulge, but it does not show which
side of the stem and bulge is involved in the connection.</p>
<div class="section" id="getting-a-condensed-representation-of-the-element-types">
<h3>Getting a Condensed Representation of the Element Types<a class="headerlink" href="#getting-a-condensed-representation-of-the-element-types" title="Permalink to this headline">¶</a></h3>
<p>Mapping nucleotide positions to secondary structure element types (stems,
hairpins, multiloops) is easily done using an example script:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ python examples/rnaConvert.py examples/input/1y26_ss.dotbracket -T element_string
(((((((((...((((((.........))))))........((((((.......))))))..)))))))))
sssssssssmmmsssssshhhhhhhhhssssssmmmmmmmmsssssshhhhhhhssssssmmsssssssss
</pre></div>
</div>
<p>In this example, one can clearly see that the paired regions are stems. Some
multiloops are present as well as two hairpin regions.</p>
</div>
<div class="section" id="another-example">
<h3>Another Example<a class="headerlink" href="#another-example" title="Permalink to this headline">¶</a></h3>
<p>Here’s an example with a longer sequence.</p>
<p>Let’s take an RNA sequence:</p>
<p><code class="docutils literal"><span class="pre">GAAUUGCGGGAAAGGGGUCAACAGCCGUUCAGUACCAAGUCUCAGGGGAAACUUUGAGAUGGCCUUGCAAAGGGUAUGGUAAUAAGCUGACGGACAUGGUCCUAACCACGCAGCCAAGUCCUAAGUCAACAGAUCUUCUGUUGAUAUGGAUGCAGUUC</span></code></p>
<p>With a secondary structure:</p>
<p><code class="docutils literal"><span class="pre">....((((((....((.......((((.((((.(((...(((((..........)))))...((.......))....)))......))))))))......))...)).))))......(((....((((((((...))))))))...)))........</span></code></p>
<p>Which looks like this:</p>
<img alt="_images/1gid_ss.png" class="align-center" src="_images/1gid_ss.png" />
<p>Can be transformed using the command:</p>
<p><code class="docutils literal"><span class="pre">python</span> <span class="pre">examples/rnaConvert.py</span> <span class="pre">-T</span> <span class="pre">neato</span> <span class="pre">examples/input/1gid_ss.dotbracket</span> <span class="pre">|</span> <span class="pre">neato</span> <span class="pre">-Tpng</span> <span class="pre">-o</span> <span class="pre">1gid_neato.png</span></code></p>
<p>Into a graph that looks like this:</p>
<a class="reference internal image-reference" href="_images/1gid_neato.png"><img alt="_images/1gid_neato.png" class="align-center" src="_images/1gid_neato.png" style="width: 500px; height: 500px;" /></a>
<p>Note that the graph and the secondary structure representation are oriented
differently. The multiloop at the top of the graph is at the bottom of the
secondary structure. Furthermore, some of the small bulges clearly visible in
the graph (as yellow nodes) are hard to see in the secondary structure although
they are indeed present.</p>
</div>
</div>
<div class="section" id="loading-structures">
<h2>Loading Structures<a class="headerlink" href="#loading-structures" title="Permalink to this headline">¶</a></h2>
<p>There are a number of ways to represent an RNA secondary structure and forgi
can read many of them using factory-classmethods of the <code class="code docutils literal"><span class="pre">BulgeGraph</span></code> object
or its subclass, the <code class="code docutils literal"><span class="pre">CoarseGrainedRNA</span></code> object.</p>
<p>As a high-level alternative, there is the <code class="code docutils literal"><span class="pre">load_rna</span></code> factory function available
as <code class="code docutils literal"><span class="pre">forgi.load_rna</span></code>. It automatically detects the filetype of the
input file, calls the correct constructor and returns a list of
CoarseGrainRNA objects.</p>
<div class="section" id="loading-a-structure-from-a-dot-bracket-string">
<h3>Loading a Structure from a Dot-Bracket String<a class="headerlink" href="#loading-a-structure-from-a-dot-bracket-string" title="Permalink to this headline">¶</a></h3>
<p>A pseudoknot-free secondary structure can be represented a sequence of dots and
brackets where the dots represent unpaired bases and the matching brackets
represent base pairs. This representation is often delivered as the output of
secondary structure prediction tools such as <a class="reference external" href="http://rna.tbi.univie.ac.at/cgi-bin/RNAfold.cgi">RNAfold</a>. It can
also be used as input to create a skeleton graph in <code class="code docutils literal"><span class="pre">forgi</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">forgi.graph.bulge_graph</span> <span class="k">as</span> <span class="nn">fgb</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span> <span class="o">=</span> <span class="n">fgb</span><span class="o">.</span><span class="n">BulgeGraph</span><span class="o">.</span><span class="n">from_dotbracket</span><span class="p">(</span><span class="s1">&#39;((..))..((..))&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">bg</span><span class="o">.</span><span class="n">to_bg_string</span><span class="p">()</span>
<span class="go">name untitled</span>
<span class="go">length 14</span>
<span class="go">seq_ids</span>
<span class="go">define h1 11 12</span>
<span class="go">define s1 9 10 13 14</span>
<span class="go">define s0 1 2 5 6</span>
<span class="go">define m0 7 8</span>
<span class="go">define h0 3 4</span>
<span class="go">connect s1 h1 m0</span>
<span class="go">connect s0 h0 m0</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-a-structure-from-a-bpseq-formatted-file">
<h3>Loading a Structure from a BPSEQ Formatted File:<a class="headerlink" href="#loading-a-structure-from-a-bpseq-formatted-file" title="Permalink to this headline">¶</a></h3>
<p>A bpseq-formatted file stores the sequence and base-pair content of an RNA
secondary structure using one line for each nucleotide in the sequence. Each
line has three columns, the index of the nucleotide being described, it’s
identity (A, C, G, or U) and the index of its pairing partner (0 if none). We
can load this file and create graph structure from it using the
<code class="code docutils literal"><span class="pre">from_bpseq_str</span></code> function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">forgi.graph.bulge_graph</span> <span class="k">as</span> <span class="nn">fgb</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bpstr</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;1 A 0</span>
<span class="gp">... </span><span class="s2">2 A 12</span>
<span class="gp">... </span><span class="s2">3 A 11</span>
<span class="gp">... </span><span class="s2">4 A 9</span>
<span class="gp">... </span><span class="s2">5 A 8</span>
<span class="gp">... </span><span class="s2">6 A 0</span>
<span class="gp">... </span><span class="s2">7 A 0</span>
<span class="gp">... </span><span class="s2">8 A 5</span>
<span class="gp">... </span><span class="s2">9 A 4</span>
<span class="gp">... </span><span class="s2">10 A 0</span>
<span class="gp">... </span><span class="s2">11 A 3</span>
<span class="gp">... </span><span class="s2">12 A 2</span>
<span class="gp">... </span><span class="s2">13 A 0</span>
<span class="gp">... </span><span class="s2">14 A 0</span>
<span class="gp">... </span><span class="s2">15 A 20</span>
<span class="gp">... </span><span class="s2">16 A 19</span>
<span class="gp">... </span><span class="s2">17 A 0</span>
<span class="gp">... </span><span class="s2">18 A 0</span>
<span class="gp">... </span><span class="s2">19 A 16</span>
<span class="gp">... </span><span class="s2">20 A 15</span>
<span class="gp">... </span><span class="s2">21 A 0</span>
<span class="gp">... </span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span> <span class="o">=</span> <span class="n">fbg</span><span class="o">.</span><span class="n">BulgeGraph</span><span class="o">.</span><span class="n">from_bpseq_str</span><span class="p">(</span><span class="n">bpstr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">bg</span><span class="o">.</span><span class="n">to_bg_string</span><span class="p">()</span>
<span class="go">name untitled</span>
<span class="go">length 21</span>
<span class="go">seq AAAAAAAAAAAAAAAAAAAAA</span>
<span class="go">seq_ids</span>
<span class="go">define f1 1 1</span>
<span class="go">define i0 10 10</span>
<span class="go">define h1 17 18</span>
<span class="go">define s2 15 16 19 20</span>
<span class="go">define s1 4 5 8 9</span>
<span class="go">define s0 2 3 11 12</span>
<span class="go">define t1 21 21</span>
<span class="go">define h0 6 7</span>
<span class="go">define m0 13 14</span>
<span class="go">connect s2 h1 m0 t1</span>
<span class="go">connect s1 i0 h0</span>
<span class="go">connect s0 f1 m0 i0</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-a-structure-from-a-fasta-file">
<h3>Loading a Structure from a Fasta File<a class="headerlink" href="#loading-a-structure-from-a-fasta-file" title="Permalink to this headline">¶</a></h3>
<p>A fasta file containing an id, a sequence and a secondary structure in
dot-bracket notation can be used to create a BulgeGraph structure:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">forgi.graph.bulge_graph</span> <span class="k">as</span> <span class="nn">fgb</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span> <span class="o">=</span> <span class="n">fgb</span><span class="o">.</span><span class="n">BulgeGraph</span><span class="o">.</span><span class="n">from_fasta_text</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&gt;blah</span>
<span class="gp">... </span><span class="s2">AAAACCGGGCCUUUUACCCCAAAUUGGAA</span>
<span class="gp">... </span><span class="s2">((((..(((..)))..))))...((..))</span>
<span class="gp">... </span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">bg</span><span class="o">.</span><span class="n">to_bg_string</span><span class="p">()</span>
<span class="go">name blah</span>
<span class="go">length 29</span>
<span class="go">seq AAAACCGGGCCUUUUACCCCAAAUUGGAA</span>
<span class="go">seq_ids</span>
<span class="go">define s0 1 4 17 20</span>
<span class="go">define i0 5 6 15 16</span>
<span class="go">define s1 7 9 12 14</span>
<span class="go">define h0 10 11</span>
<span class="go">define m0 21 23</span>
<span class="go">define s2 24 25 28 29</span>
<span class="go">define h1 26 27</span>
<span class="go">connect s2 h1 m0</span>
<span class="go">connect s1 i0 h0</span>
<span class="go">connect s0 i0 m0</span>
</pre></div>
</div>
</div>
<div class="section" id="using-the-load-rna-factory-function">
<h3>Using the load_rna factory function<a class="headerlink" href="#using-the-load-rna-factory-function" title="Permalink to this headline">¶</a></h3>
<p>If you prefer writing high-level code or if you are unsure about the format of the input file,
you should use the <code class="code docutils literal"><span class="pre">forgi.load_rna</span></code> factory function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">forgi.utilities.commanline_utils</span> <span class="k">as</span> <span class="nn">fuc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rnas</span> <span class="o">=</span> <span class="n">fuc</span><span class="o">.</span><span class="n">load_rna</span><span class="p">(</span><span class="s2">&quot;examples/input/1y26.fx&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">rna</span> <span class="ow">in</span> <span class="n">rnas</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="nb">print</span><span class="p">(</span><span class="n">rna</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">rna</span><span class="o">.</span><span class="n">seq_length</span><span class="p">)</span>
<span class="go">1y26 71</span>
</pre></div>
</div>
<p>Alternatively, if integration with the argparse module is desired, you can
use the <code class="code docutils literal"><span class="pre">forgi.utilities.commandline_utils.cgs_from_args</span></code> function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">forgi.utilities.commanline_utils</span> <span class="k">as</span> <span class="nn">fuc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span> <span class="o">=</span> <span class="n">fuc</span><span class="o">.</span><span class="n">get_rna_input_parser</span><span class="p">(</span><span class="s2">&quot;My commandline application does something&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--some-argument&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;some custom argument &quot;</span>
<span class="gp">... </span>                                    <span class="s2">&quot;not handled by forgi.&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rnas</span> <span class="o">=</span> <span class="n">fuc</span><span class="o">.</span><span class="n">cgs_from_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="querying-the-secondary-structure">
<h2>Querying the Secondary Structure<a class="headerlink" href="#querying-the-secondary-structure" title="Permalink to this headline">¶</a></h2>
<div class="section" id="finding-the-partner-of-a-base-pair">
<h3>Finding the Partner of a Base Pair<a class="headerlink" href="#finding-the-partner-of-a-base-pair" title="Permalink to this headline">¶</a></h3>
<p>Consider the situation where we have a secondary structure and we want to know
the base-pairing partner of nucleotide <em>n</em>. This is easily done with forgi:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="p">,</span> <span class="o">=</span> <span class="n">forgi</span><span class="o">.</span><span class="n">load_rna</span><span class="p">(</span><span class="s1">&#39;(((((((((...((((((.........))))))........((((((.......))))))..)))))))))&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">pairing_partner</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">71</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">pairing_partner</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>
<span class="go">33</span>
</pre></div>
</div>
<p>The <code class="code docutils literal"><span class="pre">pairing_partner</span></code> can alternatively take a PDB-style residue id as argument (see <a class="reference internal" href="threedee_tutorial.html#forgi-threedee-tutorial"><span class="std std-ref">RNA 3D Structure Using forgi.threedee</span></a>)</p>
</div>
<div class="section" id="extracting-a-pair-table">
<h3>Extracting a Pair Table<a class="headerlink" href="#extracting-a-pair-table" title="Permalink to this headline">¶</a></h3>
<p>We can obtain a pair table describing the pairing pattern of the nucleotides in
this molecule. The first element of the pair table always contains the number
of nucleotides in the secondary structure. Every subsequent element <strong>i</strong>
either contains the number 0, indicating the nucleotide <strong>i</strong> is unpaired or an
integer <strong>j</strong> which is the pairing partner of <strong>i</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="p">,</span> <span class="o">=</span> <span class="n">forgi</span><span class="o">.</span><span class="n">load_rna</span><span class="p">(</span><span class="s1">&#39;(((((((((...((((((.........))))))........((((((.......))))))..)))))))))&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">to_pair_table</span><span class="p">()</span>
<span class="go">[71, 71, 70, 69, 68, 67, 66, 65, 64, 63, 0, 0, 0, 33, 32, 31, 30, 29, 28, 0, 0, 0, 0, 0, 0, 0, 0, 0, 18, 17, 16, 15, 14, 13, 0, 0, 0, 0, 0, 0, 0, 0, 60, 59, 58, 57, 56, 55, 0, 0, 0, 0, 0, 0, 0, 47, 46, 45, 44, 43, 42, 0, 0, 9, 8, 7, 6, 5, 4, 3, 2, 1]</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-the-name-of-an-element-from-the-residue-number">
<h3>Getting the Name of an Element from the Residue Number<a class="headerlink" href="#getting-the-name-of-an-element-from-the-residue-number" title="Permalink to this headline">¶</a></h3>
<p>Various applictions of <code class="docutils literal"><span class="pre">forgi</span></code> require knowledge of the internal name
of a particular element. As these names are generated by <code class="docutils literal"><span class="pre">forgi</span></code> itself, it’s
useful to retrieve the name of an element given the number of a
residue which is part of it. To demonstrate how to do this we first need
to load a secondary structure:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">forgi.graph.bulge_graph</span> <span class="k">as</span> <span class="nn">fgb</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span> <span class="o">=</span> <span class="n">forgi</span><span class="o">.</span><span class="n">load_rna</span><span class="p">(</span><span class="s1">&#39;((..))..((..))&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">bg</span><span class="o">.</span><span class="n">to_bg_string</span><span class="p">()</span>
<span class="go">name untitled</span>
<span class="go">length 14</span>
<span class="go">seq_ids</span>
<span class="go">define s0 1 2 5 6</span>
<span class="go">define h0 3 4</span>
<span class="go">define m0 7 8</span>
<span class="go">define s1 9 10 13 14</span>
<span class="go">define h1 11 12</span>
<span class="go">connect s1 h1 m0</span>
<span class="go">connect s0 h0 m0</span>
</pre></div>
</div>
<p>Then we can simply query for the element name based on the residue number:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">get_elem</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&#39;s0&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">get_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">&#39;h0&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">get_elem</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="go">&#39;s1&#39;</span>
</pre></div>
</div>
<p>This can then be used to in other applications such as <a class="reference internal" href="#loop-dimensions"><span class="std std-ref">Retrieving the Dimensions of a Loop</span></a>,
<a class="reference internal" href="#iloop-iterating"><span class="std std-ref">Iterating Over the Nucleotides of an Interior Loop</span></a>, etc…</p>
<div class="section" id="finding-the-length-of-the-longest-stem">
<h4>Finding the Length of the Longest Stem<a class="headerlink" href="#finding-the-length-of-the-longest-stem" title="Permalink to this headline">¶</a></h4>
<p>For whatever reason, one may be interested in finding out how long the longest
stem in a secondary structure is. Initially, one may assume that this can
easily be done by searching for the longest string of ‘(‘ or ‘)’ in the
dot-bracket file. Unfortunately, structures with an interior loop which has an
unpaired base on only one strand will lead to an erronous result in this
example. The decomposition provided by forgi will, however, take this into
account in enumerating the structural elements. It then becomes a matter of
iterating over the stems and checking their lengths:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">bg</span><span class="p">,</span> <span class="o">=</span> <span class="n">forgi</span><span class="o">.</span><span class="n">load_rna</span><span class="p">(</span><span class="n">brackets</span><span class="p">)</span>
<span class="n">biggest_stem</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">bg</span><span class="o">.</span><span class="n">stem_iterator</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">bg</span><span class="o">.</span><span class="n">stem_length</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">biggest_stem</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">biggest_stem</span> <span class="o">=</span> <span class="p">(</span><span class="n">bg</span><span class="o">.</span><span class="n">stem_length</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the dotbracket string <code class="code docutils literal"><span class="pre">..((((..))))..</span></code> has one stem of length 4, while
the dotbracket string <code class="code docutils literal"><span class="pre">..((((..).)))..</span></code> has two stems of length 3 and 1. Thus the longest stem in the second example is only 3 nucleotides long.</p>
</div>
</div>
<div class="section" id="getting-the-sequence-of-an-element-and-its-neighbors">
<h3>Getting the Sequence of an Element and its Neighbors<a class="headerlink" href="#getting-the-sequence-of-an-element-and-its-neighbors" title="Permalink to this headline">¶</a></h3>
<p>Suppose we want to find out not only the sequence of an element, but also the
elements that surround it? This is easily done using the
<code class="code docutils literal"><span class="pre">get_flanking_sequence</span></code> function. To illustrate, let’s create a graph from a
fasta representation:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">forgi.graph.bulge_graph</span> <span class="k">as</span> <span class="nn">fgb</span>

<span class="n">fa</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&gt;blah</span>
<span class="s2">AAAACCGGGCCUUUUACCCCAAAUUGGAA</span>
<span class="s2">((((..(((..)))..))))...((..))</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">bg</span><span class="p">,</span> <span class="o">=</span> <span class="n">fgb</span><span class="o">.</span><span class="n">BulgeGraph</span><span class="o">.</span><span class="n">from_fasta_text</span><span class="p">(</span><span class="n">fa</span><span class="p">)</span>
</pre></div>
</div>
<p>From the structure, we can see that there are two hairpins (<code class="code docutils literal"><span class="pre">h0</span></code> and <code class="code docutils literal"><span class="pre">h1</span></code>), one
interior loop (<code class="code docutils literal"><span class="pre">i0</span></code>) and one multiloop (<code class="code docutils literal"><span class="pre">m0</span></code>). We can get the sequence for <code class="code docutils literal"><span class="pre">h0</span></code>
and it’s neighboring node (<code class="code docutils literal"><span class="pre">s0</span></code>) like so:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">get_flanking_sequence</span><span class="p">(</span><span class="s1">&#39;h0&#39;</span><span class="p">)</span>
<span class="go">&#39;GGGCCUUU&#39;</span>
</pre></div>
</div>
<p>The same can be done for the multiloop (<code class="code docutils literal"><span class="pre">m0</span></code>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">get_flanking_sequence</span><span class="p">(</span><span class="s1">&#39;m0&#39;</span><span class="p">)</span>
<span class="go">&#39;CCCCAAAUU&#39;</span>
</pre></div>
</div>
<p>The interior loop is a little more tricky because it is double stranded. From
the interior loop, we need to pass in a parameter indicating which side we want
(0 or 1). The 0’th strand corresponds to the one with the lower numbered
nucleotides, whereas the 1’st strand is the other. The default is the 0’th
strand:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">get_flanking_sequence</span><span class="p">(</span><span class="s1">&#39;i0&#39;</span><span class="p">)</span>
<span class="go">&#39;AAAACCGGG&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">get_flanking_sequence</span><span class="p">(</span><span class="s1">&#39;i0&#39;</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&#39;UUUUACCCC&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="retrieving-the-dimensions-of-a-loop">
<span id="loop-dimensions"></span><h3>Retrieving the Dimensions of a Loop<a class="headerlink" href="#retrieving-the-dimensions-of-a-loop" title="Permalink to this headline">¶</a></h3>
<p>Each loop can be said to have a size or dimension. For interior loops, the
dimensions take the form of a tuple and indicate how many unpaired nucleotides
are on each side. For multiloops each segment is represented individually and
thus should have only one dimension (how many unpaired nucleotides are in that
segment), but in order to maintain consistency with interior loops, we make it
a tuple by attaching 1000 as the second value:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">forgi.graph.bulge_graph</span> <span class="k">as</span> <span class="nn">fgb</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="p">,</span> <span class="o">=</span> <span class="n">forgi</span><span class="o">.</span><span class="n">load_rna</span><span class="p">(</span><span class="s1">&#39;((.(.))..((..)))&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">get_bulge_dimensions</span><span class="p">(</span><span class="s1">&#39;i0&#39;</span><span class="p">)</span>
<span class="go">(1, 0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">get_bulge_dimensions</span><span class="p">(</span><span class="s1">&#39;m0&#39;</span><span class="p">)</span>
<span class="go">(0, 1000)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">get_bulge_dimensions</span><span class="p">(</span><span class="s1">&#39;m1&#39;</span><span class="p">)</span>
<span class="go">(0, 1000)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">get_bulge_dimensions</span><span class="p">(</span><span class="s1">&#39;m2&#39;</span><span class="p">)</span>
<span class="go">(2, 1000)</span>
</pre></div>
</div>
<span class="target" id="dissolving-stems"></span></div>
<div class="section" id="finding-out-which-side-of-a-stem-a-loop-is-on">
<h3>Finding Out Which Side of a Stem a Loop Is On<a class="headerlink" href="#finding-out-which-side-of-a-stem-a-loop-is-on" title="Permalink to this headline">¶</a></h3>
<p>If one imagines a stem as having a direction where its start is the position of
the lowest numbered nucleotide within it, then a loop adjacent to the stem will
be on one side of it. Which side it’s on can be elucidated using the
<code class="docutils literal"><span class="pre">get_sides</span></code> function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">forgi.graph.bulge_graph</span> <span class="k">as</span> <span class="nn">fgb</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="p">,</span> <span class="o">=</span> <span class="n">forgi</span><span class="o">.</span><span class="n">load_rna</span><span class="p">(</span><span class="s2">&quot;..((..((..))..))..&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">get_sides</span><span class="p">(</span><span class="s1">&#39;s0&#39;</span><span class="p">,</span> <span class="s1">&#39;i0&#39;</span><span class="p">)</span>
<span class="go">(1, 0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">get_sides</span><span class="p">(</span><span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="s1">&#39;i0&#39;</span><span class="p">)</span>
<span class="go">(0, 1)</span>
</pre></div>
</div>
<p>The result shows that the loop <code class="code docutils literal"><span class="pre">i0</span></code> is on side 1 of stem <code class="code docutils literal"><span class="pre">s0</span></code> and side 0 of
stem <code class="code docutils literal"><span class="pre">s1</span></code>. <code class="code docutils literal"><span class="pre">bg.get_sides(s,b)</span></code> returns a tuple <code class="code docutils literal"><span class="pre">(sb,</span> <span class="pre">se)</span></code>, where the nucleotides
in <code class="code docutils literal"><span class="pre">bg.coords[s][sb[0]]</span></code> are on the side of the loop.</p>
</div>
</div>
<div class="section" id="iteration">
<h2>Iteration<a class="headerlink" href="#iteration" title="Permalink to this headline">¶</a></h2>
<p>forgi provides iterators for the various elements, and base pairing in the structure.</p>
<div class="section" id="iterating-over-the-nucleotides-of-an-interior-loop">
<span id="iloop-iterating"></span><h3>Iterating Over the Nucleotides of an Interior Loop<a class="headerlink" href="#iterating-over-the-nucleotides-of-an-interior-loop" title="Permalink to this headline">¶</a></h3>
<p>Imagine that we have a model of an RNA structure, and we want to list all of
the nucleotides which are in interior loop regions. This is can be done by
combining an iterator which yields all of the interior loops and another
iterator which iterates over the nucleotides within a particular element:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">forgi</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="p">,</span> <span class="o">=</span> <span class="n">forgi</span><span class="o">.</span><span class="n">load_rna</span><span class="p">(</span><span class="s2">&quot;((..((..))..))..((..((..))..))&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">iloop</span> <span class="ow">in</span> <span class="n">bg</span><span class="o">.</span><span class="n">iloop_iterator</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">rn</span> <span class="ow">in</span> <span class="n">bg</span><span class="o">.</span><span class="n">define_residue_num_iterator</span><span class="p">(</span><span class="n">iloop</span><span class="p">):</span>
<span class="gp">... </span>            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rn</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">10 11 12 13 2 3 4 5 26 27 28 29 18 19 20 21</span>
</pre></div>
</div>
</div>
<div class="section" id="iterating-over-the-list-of-elements">
<h3>Iterating Over The List of Elements<a class="headerlink" href="#iterating-over-the-list-of-elements" title="Permalink to this headline">¶</a></h3>
<p>** Stems **</p>
<p>To iterate over each stem in the structure, use the <code class="code docutils literal"><span class="pre">stem_iterator()</span></code> function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">forgi</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="p">,</span> <span class="o">=</span> <span class="n">forgi</span><span class="o">.</span><span class="n">load_rna</span><span class="p">(</span><span class="s1">&#39;((..((..))..))..((..((..))...)).&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="nb">list</span><span class="p">(</span><span class="n">bg</span><span class="o">.</span><span class="n">stem_iterator</span><span class="p">())</span>
<span class="go">[&#39;s3&#39;, &#39;s2&#39;, &#39;s1&#39;, &#39;s0&#39;]</span>
</pre></div>
</div>
<p>** Interior Loops **</p>
<p>To iterate over each interior loop in the structures, use the <code class="code docutils literal"><span class="pre">iloop_iterator()</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="nb">list</span><span class="p">(</span><span class="n">bg</span><span class="o">.</span><span class="n">iloop_iterator</span><span class="p">())</span>
<span class="go">[&#39;i1&#39;, &#39;i0&#39;]</span>
</pre></div>
</div>
<p>** Others **</p>
<p>For multiloops, hairpin loops, fiveprime regions and threeprimes regions  use
<code class="code docutils literal"><span class="pre">mloop_iterator()</span></code>, <code class="code docutils literal"><span class="pre">hloop_iterator()</span></code>, <code class="code docutils literal"><span class="pre">floop_iterator</span></code> and <code class="code docutils literal"><span class="pre">tloop_iterator</span></code>,
respectively:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="nb">list</span><span class="p">(</span><span class="n">bg</span><span class="o">.</span><span class="n">mloop_iterator</span><span class="p">())</span>
<span class="go">[&#39;m0&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="nb">list</span><span class="p">(</span><span class="n">bg</span><span class="o">.</span><span class="n">hloop_iterator</span><span class="p">())</span>
<span class="go">[&#39;h1&#39;, &#39;h0&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="nb">list</span><span class="p">(</span><span class="n">bg</span><span class="o">.</span><span class="n">floop_iterator</span><span class="p">())</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="nb">list</span><span class="p">(</span><span class="n">bg</span><span class="o">.</span><span class="n">tloop_iterator</span><span class="p">())</span>
<span class="go">[&#39;t1&#39;]</span>
</pre></div>
</div>
<p>Notice that <code class="code docutils literal"><span class="pre">floop_iterator()</span></code> doesn’t yield any values. This is because there
is no 3’ unpaired region in this structure.</p>
</div>
</div>
<div class="section" id="graph-functions">
<h2>Graph Functions<a class="headerlink" href="#graph-functions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="finding-the-minimum-spanning-tree-of-a-graph">
<h3>Finding the Minimum Spanning Tree of a Graph<a class="headerlink" href="#finding-the-minimum-spanning-tree-of-a-graph" title="Permalink to this headline">¶</a></h3>
<p>Can we create a subgraph such that all stems are connected and no cycles
remain? Recall that cycles only occur in multiloop sections (junctions). Can we
return a representation of the structure such that all stems are connected with
the least number of nucleotides between them? If interior loops and multiloop
segements were considered edges, then this would be the equivalent of a minimum
spanning tree. Since they are nodes, then the result is not a minimum spanning
tree but simply a representation of the secondary structure with broken
multiloops.</p>
<p>As an example, consider the following structure:</p>
<a class="reference internal image-reference" href="_images/mst_init.png"><img alt="_images/mst_init.png" class="align-center" src="_images/mst_init.png" style="width: 200px;" /></a>
<p>To break the cycle, we would like to remove the segment ‘m0’. This is easily
done using the <code class="code docutils literal"><span class="pre">get_mst()</span></code> function of the <code class="code docutils literal"><span class="pre">BulgeGraph</span></code> data structure:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="p">,</span> <span class="o">=</span> <span class="n">forgi</span><span class="o">.</span><span class="n">load_rna</span><span class="p">(</span><span class="s2">&quot;((..((.)).(.).))&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">get_mst</span><span class="p">()</span>
<span class="go">set([&#39;s2&#39;, &#39;s1&#39;, &#39;s0&#39;, &#39;m1&#39;, &#39;m2&#39;])</span>
</pre></div>
</div>
<p>The result contains all the nodes except the ones removed to break the cycles.
The implementation uses a slightly modified version of Kruskal’s algorithm.</p>
</div>
<div class="section" id="traversing-the-graph">
<h3>Traversing the Graph<a class="headerlink" href="#traversing-the-graph" title="Permalink to this headline">¶</a></h3>
<p>We can traverse all of the loops in a graph in breadth-first manner using the
<code class="code docutils literal"><span class="pre">traverse_graph</span></code> function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="p">,</span> <span class="o">=</span> <span class="n">forgi</span><span class="o">.</span><span class="n">load_rna</span><span class="p">(</span><span class="s1">&#39;(.(.(.(.).(.).).(.).))&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">traverse_graph</span><span class="p">()</span>
<span class="go">[(&#39;s0&#39;, &#39;i0&#39;, &#39;s1&#39;), (&#39;s1&#39;, &#39;m1&#39;, &#39;s5&#39;), (&#39;s5&#39;, &#39;m4&#39;, &#39;s2&#39;), (&#39;s2&#39;, &#39;m3&#39;, &#39;s4&#39;), (&#39;s4&#39;, &#39;m5&#39;, &#39;s3&#39;)]</span>
</pre></div>
</div>
<p>Starting with the first stem, <em>s0</em>, we visit each loop that connects it to
another stem and return all the visited loops as a list of tuples. Each tuple
has the following three elements: (from_stem, loop, to_stem).</p>
</div>
<div class="section" id="finding-the-elements-which-form-the-multiloops-of-a-structure">
<h3>Finding the elements which form the multiloops of a structure<a class="headerlink" href="#finding-the-elements-which-form-the-multiloops-of-a-structure" title="Permalink to this headline">¶</a></h3>
<p>The <code class="code docutils literal"><span class="pre">junctions</span></code> property returns a list of lists, where each inner list
describes a single non-pseudoknotted multiloop.</p>
<a class="reference internal image-reference" href="_images/find_loops.png"><img alt="_images/find_loops.png" class="align-center" src="_images/find_loops.png" style="width: 290px;" /></a>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">forgi</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="p">,</span> <span class="o">=</span> <span class="n">forgi</span><span class="o">.</span><span class="n">load_rna</span><span class="p">(</span><span class="s1">&#39;(.(.(.(.).(.).).(.).))&#39;</span><span class="p">,</span> <span class="n">dissolve_length_one_stems</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">bg</span><span class="o">.</span><span class="n">junctions</span><span class="p">()</span>
<span class="go">[[&#39;m0&#39;, &#39;m4&#39;, &#39;m5&#39;], [&#39;m1&#39;, &#39;m2&#39;, &#39;m3&#39;]]</span>
</pre></div>
</div>
<p>The order of the loops and within the loops is well defined:
The loops are ordered alphabetically by their first element.
The order inside the loop is from the 5’ to 3’ along the RNA chain.</p>
</div>
<div class="section" id="finding-rods-or-helices">
<h3>Finding rods or helices<a class="headerlink" href="#finding-rods-or-helices" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="calculating-the-minimum-secondary-structure-distance-between-two-elements">
<h3>Calculating the Minimum Secondary Structure Distance Between Two Elements<a class="headerlink" href="#calculating-the-minimum-secondary-structure-distance-between-two-elements" title="Permalink to this headline">¶</a></h3>
<p>The secondary structure distance, in our case, will be calculated as the
distance along the backbone or along base-pair links. When calculated between
two elements, it is the minimum distance between any two pairs of nucleotides
in each of the two elements.</p>
<p>Consider the following example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="p">,</span> <span class="o">=</span> <span class="n">forgi</span><span class="o">.</span><span class="n">load_rna</span><span class="p">(</span><span class="s1">&#39;((..))..((..))((..))&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">ss_distance</span><span class="p">(</span><span class="s1">&#39;s0&#39;</span><span class="p">,</span> <span class="s1">&#39;s1&#39;</span><span class="p">)</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">ss_distance</span><span class="p">(</span><span class="s1">&#39;s0&#39;</span><span class="p">,</span> <span class="s1">&#39;s2&#39;</span><span class="p">)</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bg</span><span class="o">.</span><span class="n">ss_distance</span><span class="p">(</span><span class="s1">&#39;s0&#39;</span><span class="p">,</span> <span class="s1">&#39;h2&#39;</span><span class="p">)</span>
<span class="go">7</span>
</pre></div>
</div>
<p>The first distance requires going over three backbone edges. The second distance
Requires three backbone, one base pair, and one more backbone. The last distance
requires three backbone, one base pair, and three more backbone links.</p>
</div>
</div>
<div class="section" id="getting-the-neighbors-of-elements-in-a-specified-range">
<h2>Getting the neighbors of elements in a specified range<a class="headerlink" href="#getting-the-neighbors-of-elements-in-a-specified-range" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference external" href="https://github.com/ViennaRNA/forgi/issues/33">https://github.com/ViennaRNA/forgi/issues/33</a>.</p>
<div class="section" id="elements-upstream-and-downstream">
<h3>Elements upstream and downstream<a class="headerlink" href="#elements-upstream-and-downstream" title="Permalink to this headline">¶</a></h3>
<p>To get all elements that are within 10 nts of an element E1,
but not along other branches of junctions, you can do the following:</p>
<p>If you want to get the microenvironment of nucleotide 80:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">forgi</span>
<span class="kn">import</span> <span class="nn">forgi.graph.bulge_graph</span> <span class="k">as</span> <span class="nn">fgb</span>
<span class="n">fx</span> <span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">GAAUUGCGGGAAAGGGGUCAACAGCCGUUCAGUACCAAGUCUCAGGGGAAACUUUGAGAUGGCCUUGCAAAGGGUAUGGUAAUAAGCUGACGGACAUGGUCCUAACCACGCAGCCAAGUCCUAAGUCAACAGAUCUUCUGUUGAUAUGGAUGCAGUUC</span>
<span class="s2">....((((((....((.......((((.((((.(((...(((((..........)))))...((.......))....)))......))))))))......))...)).))))......(((....((((((((...))))))))...)))......</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">nuc_number</span> <span class="o">=</span> <span class="mi">80</span> <span class="c1"># Nucleotide of interest</span>
<span class="n">rna</span> <span class="o">=</span> <span class="n">fgb</span><span class="o">.</span><span class="n">BulgeGraph</span><span class="o">.</span><span class="n">from_fasta_text</span><span class="p">(</span><span class="n">fx</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">elems</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nuc_number</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="n">nuc_number</span><span class="o">+</span><span class="mi">11</span><span class="p">):</span>
    <span class="n">elems</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rna</span><span class="o">.</span><span class="n">get_elem</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">elems</span><span class="p">)))</span>
</pre></div>
</div>
<p>This gives <code class="code docutils literal"><span class="pre">&quot;h0,</span> <span class="pre">h1,</span> <span class="pre">m1,</span> <span class="pre">s6,</span> <span class="pre">s7&quot;</span></code>. So you have two hairpins (h0 and h1),
a multiloop segments and two stems. To find out how the multiloop segments are
connected, you can use the property <code class="code docutils literal"><span class="pre">rna.junctions</span></code>, which tells you that
<code class="code docutils literal"><span class="pre">m0,m1</span> <span class="pre">and</span> <span class="pre">m2</span></code> form a 3-way junction, while <code class="code docutils literal"><span class="pre">f0,m3</span> <span class="pre">and</span> <span class="pre">t0</span></code> form the exterior loop.</p>
</div>
<div class="section" id="elements-with-small-secondary-structure-distance">
<h3>Elements with small secondary structure distance<a class="headerlink" href="#elements-with-small-secondary-structure-distance" title="Permalink to this headline">¶</a></h3>
<p>Now we will consider the pairing partner of a nucleotide to have a distance of 1
to the nucleotide, and follow all branches up to a distance of 10:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">elems</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">rna</span><span class="o">.</span><span class="n">defines</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">rna</span><span class="o">.</span><span class="n">ss_distance</span><span class="p">(</span><span class="mi">58</span><span class="p">,</span> <span class="n">ref_elem</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">10</span><span class="p">:</span>
        <span class="n">elems</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">elems</span><span class="p">)))</span>
</pre></div>
</div>
<p>This gives <code class="code docutils literal"><span class="pre">&quot;h0,h1,i3,m0,m1,m2,s4,s5,s6,s7&quot;</span></code>.</p>
</div>
</div>
<div class="section" id="applications">
<h2>Applications<a class="headerlink" href="#applications" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rosetta-rna-denovo-constraint-file-creation">
<h3>Rosetta rna_denovo Constraint File Creation<a class="headerlink" href="#rosetta-rna-denovo-constraint-file-creation" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://www.rosettacommons.org/">Rosetta</a> protein structure prediction
package provides a program for RNA 3D structure prediction called <a class="reference external" href="http://www.rosettacommons.org/manuals/rosetta3.3_user_guide/d2/d82/rna_denovo.html">rna_denovo</a>.
To specify the secondary structure of an RNA molecule, one needs to pass in a
parameter file indicating which nucleotides are paired.</p>
<p>Given an dot-bracket sequence as input, forgi can be easily be used to generate
the parameter file for rna_denovo. Using the secondary structure of 1y26 (shown
in the first example) one can run the appropriate example:</p>
<p><code class="docutils literal"><span class="pre">python</span> <span class="pre">examples/dotbracket_to_rosetta_constraints.py</span> <span class="pre">examples/1y26_ss.dotbracket</span></code></p>
<p>And get an appropriately formatted parameter file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">42</span> <span class="mi">60</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">43</span> <span class="mi">59</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">44</span> <span class="mi">58</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">45</span> <span class="mi">57</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">46</span> <span class="mi">56</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">47</span> <span class="mi">55</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">13</span> <span class="mi">33</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">14</span> <span class="mi">32</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">15</span> <span class="mi">31</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">16</span> <span class="mi">30</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">17</span> <span class="mi">29</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">18</span> <span class="mi">28</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">19</span> <span class="mi">27</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">1</span> <span class="mi">71</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">2</span> <span class="mi">70</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">3</span> <span class="mi">69</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">4</span> <span class="mi">68</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">5</span> <span class="mi">67</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">6</span> <span class="mi">66</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">7</span> <span class="mi">65</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">8</span> <span class="mi">64</span>
<span class="n">STEM</span> <span class="n">PAIR</span> <span class="mi">9</span> <span class="mi">63</span>
</pre></div>
</div>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="scripts_tutorial.html">Useful scripts coming with forgi</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="threedee_tutorial.html">RNA 3D Structure Using forgi.threedee</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2012-2016 Peter Kerpedjiev &lt;pkerp@tbi.univie.ac.at&gt;; 2015-2018 Bernhard Thiel &lt;thiel@tbi.univie.ac.at&gt;.
      Last updated on Feb 25, 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.
    </div>
  </body>
</html>